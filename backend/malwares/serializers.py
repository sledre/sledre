from rest_framework import serializers

from malwares.models import Malware


class MalwareSerializer(serializers.ModelSerializer):
    # Don't render filepath to users
    file = serializers.FileField(write_only=True)

    class Meta:
        model = Malware
        fields = "__all__"

    # Send only the results in details view
    def get_fields(self, *args, **kwargs):
        fields = super().get_fields(*args, **kwargs)
        request = self.context.get("request")
        if request is not None and not request.parser_context.get("kwargs"):
            fields.pop("agent_result", None)
        return fields
